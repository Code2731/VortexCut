<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:VortexCut.UI.ViewModels"
             xmlns:controls="clr-namespace:VortexCut.UI.Controls"
             mc:Ignorable="d" d:DesignWidth="300" d:DesignHeight="600"
             x:Class="VortexCut.UI.Views.InspectorView"
             x:DataType="vm:MainViewModel">

    <Grid RowDefinitions="Auto, *">
        <!-- 워크스페이스 이름 헤더 + HISTORY 탭 토글 -->
        <Border Classes="PanelHeader">
            <Grid ColumnDefinitions="*, Auto">
                <TextBlock x:Name="WorkspaceTitle" Classes="PanelTitle"
                           Text="PROPERTIES" VerticalAlignment="Center"/>
                <StackPanel Grid.Column="1" Orientation="Horizontal"
                            Spacing="2" VerticalAlignment="Center" Margin="0,0,4,0">
                    <Button x:Name="PropertiesTabBtn" Content="PROPS"
                            Classes="HeaderTabActive" FontSize="10" Padding="6,2"
                            Click="OnPropertiesTabClick"/>
                    <Button x:Name="HistoryTabBtn" Content="HISTORY"
                            Classes="HeaderTab" FontSize="10" Padding="6,2"
                            Click="OnHistoryTabClick"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- ==================== Editing: Properties ==================== -->
        <Panel x:Name="PropertiesPanel" Grid.Row="1" IsVisible="True" Background="{StaticResource BgPanelBrush}">
            <!-- 클립 선택 시 속성 편집 -->
            <ScrollViewer x:Name="PropertiesScrollViewer"
                          IsVisible="{Binding Timeline.SelectedClip, Converter={x:Static ObjectConverters.IsNotNull}}">
                <StackPanel Margin="12" Spacing="12">
                    <TextBlock Text="Clip Info" FontWeight="SemiBold" Foreground="{StaticResource TextPrimaryBrush}" FontSize="12"/>

                    <!-- 파일 이름 (읽기 전용) -->
                    <StackPanel Spacing="4">
                        <TextBlock Text="Name" Foreground="{StaticResource TextSecondaryBrush}" FontSize="11"/>
                        <TextBlock x:Name="ClipNameText" Text="-" Foreground="{StaticResource TextPrimaryBrush}" FontSize="12"
                                   TextTrimming="CharacterEllipsis"/>
                    </StackPanel>

                    <!-- 파일 경로 (읽기 전용) -->
                    <StackPanel Spacing="4">
                        <TextBlock Text="Path" Foreground="{StaticResource TextSecondaryBrush}" FontSize="11"/>
                        <TextBlock x:Name="ClipPathText" Text="-" Foreground="{StaticResource TextSecondaryBrush}" FontSize="10"
                                   TextTrimming="CharacterEllipsis" ToolTip.Tip="{Binding Timeline.SelectedClip.FilePath}"/>
                    </StackPanel>

                    <Separator Background="{StaticResource BorderBrush}" Height="1" Margin="0,4"/>

                    <TextBlock Text="Position" FontWeight="SemiBold" Foreground="{StaticResource TextPrimaryBrush}" FontSize="12"/>

                    <!-- 시작 시간 -->
                    <controls:PropertyEditorControl x:Name="StartTimeEditor"
                                                    Label="Start Time (ms)"
                                                    DisplayValue="0"
                                                    Minimum="0"
                                                    Maximum="600000"
                                                    Value="0"
                                                    SmallChange="100"
                                                    LargeChange="1000"/>

                    <!-- 길이 -->
                    <controls:PropertyEditorControl x:Name="DurationEditor"
                                                    Label="Duration (ms)"
                                                    DisplayValue="0"
                                                    Minimum="100"
                                                    Maximum="600000"
                                                    Value="1000"
                                                    SmallChange="100"
                                                    LargeChange="1000"/>

                    <!-- 트랙 번호 -->
                    <StackPanel Spacing="4">
                        <Grid ColumnDefinitions="*, Auto">
                            <TextBlock Text="Track" Foreground="{StaticResource TextSecondaryBrush}" FontSize="11"/>
                            <TextBlock x:Name="TrackIndexValueText" Grid.Column="1" Text="V1" Foreground="{StaticResource TextPrimaryBrush}" FontSize="11"/>
                        </Grid>
                    </StackPanel>

                    <Separator Background="{StaticResource BorderBrush}" Height="1" Margin="0,4"/>

                    <TextBlock Text="Opacity" FontWeight="SemiBold" Foreground="{StaticResource TextPrimaryBrush}" FontSize="12"/>

                    <controls:PropertyEditorControl x:Name="OpacityEditor"
                                                    Label="Opacity"
                                                    DisplayValue="100%"
                                                    Minimum="0"
                                                    Maximum="100"
                                                    Value="100"
                                                    SmallChange="1"
                                                    LargeChange="10"/>

                    <Separator Background="{StaticResource BorderBrush}" Height="1" Margin="0,4"/>

                    <Button x:Name="ResetPropertiesButton"
                            Content="Reset Position"
                            HorizontalAlignment="Stretch"
                            HorizontalContentAlignment="Center"
                            FontSize="11"/>
                </StackPanel>
            </ScrollViewer>
            <!-- 선택 없을 때 안내 -->
            <TextBlock
                IsVisible="{Binding Timeline.SelectedClip, Converter={x:Static ObjectConverters.IsNull}}"
                Text="클립을 선택하세요"
                Foreground="{StaticResource TextSecondaryBrush}"
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                FontSize="13"/>
        </Panel>

        <!-- ==================== Color ==================== -->
        <Panel x:Name="ColorPanel" Grid.Row="1" IsVisible="False" Background="{StaticResource BgPanelBrush}">
            <ScrollViewer>
                <StackPanel Margin="12" Spacing="12">
                    <TextBlock Text="Color Grading" FontWeight="SemiBold" Foreground="{StaticResource TextPrimaryBrush}" FontSize="12"/>

                    <controls:PropertyEditorControl x:Name="BrightnessEditor"
                                                    Label="Brightness"
                                                    DisplayValue="0"
                                                    Minimum="-100"
                                                    Maximum="100"
                                                    Value="0"
                                                    SmallChange="1"
                                                    LargeChange="10"/>

                    <controls:PropertyEditorControl x:Name="ContrastEditor"
                                                    Label="Contrast"
                                                    DisplayValue="0"
                                                    Minimum="-100"
                                                    Maximum="100"
                                                    Value="0"
                                                    SmallChange="1"
                                                    LargeChange="10"/>

                    <controls:PropertyEditorControl x:Name="SaturationEditor"
                                                    Label="Saturation"
                                                    DisplayValue="0"
                                                    Minimum="-100"
                                                    Maximum="100"
                                                    Value="0"
                                                    SmallChange="1"
                                                    LargeChange="10"/>

                    <Separator Background="{StaticResource BorderBrush}" Height="1" Margin="0,4"/>

                    <controls:PropertyEditorControl x:Name="TemperatureEditor"
                                                    Label="Temperature"
                                                    DisplayValue="0"
                                                    Minimum="-100"
                                                    Maximum="100"
                                                    Value="0"
                                                    SmallChange="1"
                                                    LargeChange="10"/>

                    <Separator Background="{StaticResource BorderBrush}" Height="1" Margin="0,4"/>

                    <Button x:Name="ResetEffectsButton"
                            Content="Reset All"
                            HorizontalAlignment="Stretch"
                            HorizontalContentAlignment="Center"
                            FontSize="11"/>
                </StackPanel>
            </ScrollViewer>
        </Panel>

        <!-- ==================== Audio ==================== -->
        <Panel x:Name="AudioPanel" Grid.Row="1" IsVisible="False" Background="{StaticResource BgPanelBrush}">
            <ScrollViewer>
                <StackPanel Margin="12" Spacing="12">
                    <TextBlock Text="Clip Audio" FontWeight="SemiBold" Foreground="{StaticResource TextPrimaryBrush}" FontSize="12"/>

                    <!-- Volume (0% ~ 200%) -->
                    <controls:PropertyEditorControl x:Name="VolumeEditor"
                                                    Label="Volume"
                                                    DisplayValue="100%"
                                                    Minimum="0"
                                                    Maximum="200"
                                                    Value="100"
                                                    SmallChange="1"
                                                    LargeChange="10"/>

                    <!-- Speed (0.25x ~ 4.0x) -->
                    <controls:PropertyEditorControl x:Name="SpeedEditor"
                                                    Label="Speed"
                                                    DisplayValue="1.00x"
                                                    Minimum="25"
                                                    Maximum="400"
                                                    Value="100"
                                                    SmallChange="5"
                                                    LargeChange="25"/>

                    <Separator Background="{StaticResource BorderBrush}" Height="1" Margin="0,4"/>

                    <!-- Fade In/Out -->
                    <TextBlock Text="Fade" FontWeight="SemiBold" Foreground="{StaticResource TextPrimaryBrush}" FontSize="12"/>

                    <controls:PropertyEditorControl x:Name="FadeInEditor"
                                                    Label="Fade In"
                                                    DisplayValue="0ms"
                                                    Minimum="0"
                                                    Maximum="5000"
                                                    Value="0"
                                                    SmallChange="100"
                                                    LargeChange="500"/>

                    <controls:PropertyEditorControl x:Name="FadeOutEditor"
                                                    Label="Fade Out"
                                                    DisplayValue="0ms"
                                                    Minimum="0"
                                                    Maximum="5000"
                                                    Value="0"
                                                    SmallChange="100"
                                                    LargeChange="500"/>

                    <Separator Background="{StaticResource BorderBrush}" Height="1" Margin="0,4"/>

                    <Button x:Name="ResetAudioButton"
                            Content="Reset All"
                            HorizontalAlignment="Stretch"
                            HorizontalContentAlignment="Center"
                            FontSize="11"/>
                </StackPanel>
            </ScrollViewer>
        </Panel>

        <!-- ==================== Effects: Subtitle + Transition ==================== -->
        <Panel x:Name="EffectsPanel" Grid.Row="1" IsVisible="False" Background="{StaticResource BgPanelBrush}">
            <ScrollViewer>
                <StackPanel Margin="12" Spacing="12">

                    <!-- Subtitle 섹션 (자막 클립일 때만 표시) -->
                    <Panel x:Name="SubtitleEditPanel" IsVisible="False">
                        <StackPanel Spacing="12">
                            <TextBlock Text="자막 편집" FontWeight="SemiBold" Foreground="{StaticResource TextPrimaryBrush}" FontSize="12"/>

                            <StackPanel Spacing="4">
                                <TextBlock Text="텍스트" Foreground="{StaticResource TextSecondaryBrush}" FontSize="11"/>
                                <TextBox x:Name="SubtitleTextBox"
                                         AcceptsReturn="True"
                                         MinHeight="80"
                                         MaxHeight="200"
                                         TextWrapping="Wrap"
                                         Watermark="자막 텍스트를 입력하세요..."
                                         FontSize="13"/>
                            </StackPanel>

                            <Separator Background="{StaticResource BorderBrush}" Height="1" Margin="0,4"/>

                            <TextBlock Text="스타일" FontWeight="SemiBold" Foreground="{StaticResource TextPrimaryBrush}" FontSize="12"/>

                            <!-- Font Size -->
                            <StackPanel Spacing="4">
                                <Grid ColumnDefinitions="*, Auto">
                                    <TextBlock Text="폰트 크기" Foreground="{StaticResource TextSecondaryBrush}" FontSize="11"/>
                                    <TextBlock x:Name="FontSizeValueText" Grid.Column="1" Text="48" Foreground="{StaticResource TextPrimaryBrush}" FontSize="11"/>
                                </Grid>
                                <Slider x:Name="FontSizeSlider" Minimum="12" Maximum="96" Value="48" SmallChange="1" LargeChange="8"/>
                            </StackPanel>

                            <!-- Position -->
                            <StackPanel Spacing="4">
                                <TextBlock Text="위치" Foreground="{StaticResource TextSecondaryBrush}" FontSize="11"/>
                                <ComboBox x:Name="SubtitlePositionComboBox" SelectedIndex="2" HorizontalAlignment="Stretch">
                                    <ComboBoxItem Content="상단"/>
                                    <ComboBoxItem Content="중앙"/>
                                    <ComboBoxItem Content="하단"/>
                                </ComboBox>
                            </StackPanel>

                            <!-- Bold / Italic -->
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <ToggleButton x:Name="BoldToggle" Content="B" FontWeight="Bold" Width="36" Height="30"
                                              HorizontalContentAlignment="Center" VerticalContentAlignment="Center" FontSize="13"/>
                                <ToggleButton x:Name="ItalicToggle" Content="I" FontStyle="Italic" Width="36" Height="30"
                                              HorizontalContentAlignment="Center" VerticalContentAlignment="Center" FontSize="13"/>
                            </StackPanel>

                            <!-- 스타일 버튼 행 -->
                            <Grid ColumnDefinitions="*, 8, *">
                                <Button x:Name="ApplyToAllSubtitleButton"
                                        Grid.Column="0"
                                        Content="모든 자막에 적용"
                                        HorizontalAlignment="Stretch"
                                        HorizontalContentAlignment="Center"
                                        Background="{StaticResource AccentBrush}"
                                        Foreground="White"
                                        FontSize="11"/>
                                <Button x:Name="ResetSubtitleButton"
                                        Grid.Column="2"
                                        Content="Reset Style"
                                        HorizontalAlignment="Stretch"
                                        HorizontalContentAlignment="Center"
                                        FontSize="11"/>
                            </Grid>

                            <Separator Background="{StaticResource BorderBrush}" Height="1" Margin="0,4"/>
                        </StackPanel>
                    </Panel>

                    <!-- Transition 섹션 (항상 표시) -->
                    <TextBlock Text="Video Transition" FontWeight="SemiBold" Foreground="{StaticResource TextPrimaryBrush}" FontSize="12"/>

                    <TextBlock Text="겹치는 클립 구간에서 적용됩니다."
                               Foreground="{StaticResource TextSecondaryBrush}"
                               FontSize="11"
                               TextWrapping="Wrap"/>

                    <StackPanel Spacing="4">
                        <TextBlock Text="Transition Type" Foreground="{StaticResource TextSecondaryBrush}" FontSize="11"/>
                        <ComboBox x:Name="TransitionTypeComboBox" HorizontalAlignment="Stretch" SelectedIndex="0">
                            <ComboBoxItem Content="None"/>
                            <ComboBoxItem Content="Crossfade"/>
                            <ComboBoxItem Content="Fade through Black"/>
                            <ComboBoxItem Content="Wipe Left"/>
                            <ComboBoxItem Content="Wipe Right"/>
                            <ComboBoxItem Content="Wipe Up"/>
                            <ComboBoxItem Content="Wipe Down"/>
                        </ComboBox>
                    </StackPanel>

                    <Separator Background="{StaticResource BorderBrush}" Height="1" Margin="0,4"/>

                    <Button x:Name="ResetTransitionButton"
                            Content="Reset"
                            HorizontalAlignment="Stretch"
                            HorizontalContentAlignment="Center"
                            FontSize="11"/>
                </StackPanel>
            </ScrollViewer>
        </Panel>

        <!-- ==================== History Panel ==================== -->
        <Panel x:Name="HistoryPanel" Grid.Row="1" IsVisible="False" Background="{StaticResource BgPanelBrush}">
            <Grid RowDefinitions="Auto, *">
                <!-- 히스토리 패널 툴바 -->
                <Border Grid.Row="0" Background="{StaticResource BgDarkBrush}"
                        BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,0,0,1"
                        Padding="8,4">
                    <Grid ColumnDefinitions="*, Auto">
                        <TextBlock Text="작업 기록" FontSize="11"
                                   Foreground="{StaticResource TextSecondaryBrush}"
                                   VerticalAlignment="Center"/>
                        <Button x:Name="ClearHistoryBtn" Grid.Column="1"
                                Content="Clear" FontSize="10" Padding="8,2"
                                Click="OnClearHistoryClick"/>
                    </Grid>
                </Border>

                <!-- 히스토리 목록 -->
                <ScrollViewer Grid.Row="1" x:Name="HistoryScrollViewer">
                    <ItemsControl x:Name="HistoryItemsControl"
                                  ItemsSource="{Binding Timeline.HistoryEntries}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Button x:Name="HistoryItemBtn"
                                        HorizontalAlignment="Stretch"
                                        HorizontalContentAlignment="Left"
                                        Background="Transparent"
                                        BorderThickness="0"
                                        Padding="10,4"
                                        Opacity="{Binding DisplayOpacity}"
                                        Click="OnHistoryItemClick">
                                    <Grid ColumnDefinitions="16,*">
                                        <TextBlock Grid.Column="0"
                                                   Text="{Binding BulletChar}"
                                                   FontSize="9"
                                                   Foreground="{StaticResource AccentBrush}"
                                                   VerticalAlignment="Center"/>
                                        <TextBlock Grid.Column="1"
                                                   Text="{Binding Description}"
                                                   FontSize="11"
                                                   FontWeight="{Binding FontWeightStr}"
                                                   Foreground="{StaticResource TextPrimaryBrush}"
                                                   TextTrimming="CharacterEllipsis"/>
                                    </Grid>
                                </Button>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </Grid>
        </Panel>
    </Grid>
</UserControl>
